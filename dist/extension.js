"use strict";var j=Object.create;var E=Object.defineProperty;var q=Object.getOwnPropertyDescriptor;var Q=Object.getOwnPropertyNames;var V=Object.getPrototypeOf,L=Object.prototype.hasOwnProperty;var z=(e,t)=>{for(var s in t)E(e,s,{get:t[s],enumerable:!0})},H=(e,t,s,c)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Q(t))!L.call(e,o)&&o!==s&&E(e,o,{get:()=>t[o],enumerable:!(c=q(t,o))||c.enumerable});return e};var T=(e,t,s)=>(s=e!=null?j(V(e)):{},H(t||!e||!e.__esModule?E(s,"default",{value:e,enumerable:!0}):s,e)),D=e=>H(E({},"__esModule",{value:!0}),e);var ee={};z(ee,{activate:()=>Y,deactivate:()=>_});module.exports=D(ee);var S=T(require("vscode"));var x=T(require("vscode"));var I=T(require("vscode"));function k(e){let t=[],s=[],c={"(":")","{":"}","[":"]"},o=['"',"'"],g=I.window.activeTextEditor?.document.languageId||"",l=Z(e),n=$(e,g),i=[...l,...n],p=null,m=-1;for(let f=0;f<e.length;f++){if(G(f,i))continue;let a=e[f];if(o.includes(a)){p===null?(p=a,m=f):p===a&&(s.push({open:m,close:f,type:a}),p=null);continue}if(!p){if(c[a])t.push({char:a,pos:f});else if(Object.values(c).includes(a)){for(let r=t.length-1;r>=0;r--)if(c[t[r].char]===a){let u=t[r];s.push({open:u.pos,close:f,type:u.char}),t.splice(r,1);break}}}}return s}function G(e,t){return t.some(s=>e>=s.start&&e<=s.end)}function Z(e){let t=[],s=!1,c=-1;for(let o=0;o<e.length;o++){let g=e[o];if(!s&&g==="/"){let l=e[o-1];if(!l||/\s|[\(\{;\n]/.test(l)){s=!0,c=o;continue}}else s&&g==="/"&&e[o-1]!=="\\"&&(t.push({start:c,end:o}),s=!1)}return t}function $(e,t){let s=[],c=[],o=(t||"").toString().trim().toLowerCase();switch(o=o.replace(/^.*[\\/]/,""),o.includes(".")&&(o=o.split(".").pop()||o),o.startsWith(".")&&(o=o.slice(1)),o){case"js":case"ts":case"java":case"c":case"cpp":case"cs":c.push(/\/\/.*/g),c.push(/\/\*[\s\S]*?\*\//g);break;case"py":case"rb":c.push(/#.*$/gm),c.push(/('{3}|"{3})[\s\S]*?\1/gm);break;case"html":case"xml":c.push(/<!--[\s\S]*?-->/g);break;default:return s}for(let l of c){l.lastIndex=0;let n;for(;(n=l.exec(e))!==null;)s.push({start:n.index,end:n.index+n[0].length-1}),n[0].length===0&&l.lastIndex++}s.sort((l,n)=>l.start-n.start);let g=[];for(let l of s)if(!g.length)g.push({...l});else{let n=g[g.length-1];l.start<=n.end+1?n.end=Math.max(n.end,l.end):g.push({...l})}return g}var F=new Set(["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr"]),O=new Map;function J(e){let t={tag:"root",start:0,end:e.length-1,children:[]},s=[t],c=/<\/?([a-zA-Z0-9-]+)(\s[^<>]*?)?(\/?)>/g,o;for(;(o=c.exec(e))!==null;){let[g,l,n,i]=o,p=o.index,m=o.index+g.length-1,f=s[s.length-1];if(g.startsWith("</")){for(let a=s.length-1;a>=0;a--)if(s[a].tag===l){let r=s[a];r.end=m,s.splice(a);break}}else{let a={tag:l,start:p,end:m,children:[],parent:f};f.children.push(a),i==="/"||F.has(l.toLowerCase())?a.end=m:s.push(a)}}return t}function K(e){let t=e.uri.toString(),s=O.get(t);if(s&&s.version===e.version)return s.root.children;let c=e.getText(),o=J(c);return O.set(t,{version:e.version,root:o}),o.children}function N(e,t,s){if(e.tag!=="root"){t.push({open:e.start,close:e.end,type:e.tag});let o=s.slice(e.start,e.end+1).match(/^<[^>]+>/);if(o){let g=o[0],l=/([^\s=]+)\s*=\s*("([^"]*)"|'([^']*)')/g,n,i=!1;for(;(n=l.exec(g))!==null;){let p=n[1],m=n[0],f=n[2][0],a=n[3]??n[4],r=e.start+n.index,u=r+m.length,d=r+m.indexOf(f)+1,h=d+a.length;t.push({open:d,close:h,type:"attrValue"}),t.push({open:r,close:u,type:"attr"}),i||(t.push({open:e.start,close:e.start+g.length,type:"openTag"}),i=!0)}}}for(let c of e.children)N(c,t,s)}function M(){let e=x.window.activeTextEditor;if(!e)return;e.document.languageId==="html"?U():X()}var b=[];function U(){let e=x.window.activeTextEditor;if(!e)return;let t=e.document,s=t.getText(),c=e.selections,o=[],g=K(t);for(let n of g)N(n,o,s);if(o.length===0)return;b.length<c.length?b=[...b,...Array(c.length-b.length).fill(-1)]:b.length>c.length&&(b=b.slice(0,c.length));let l=c.map((n,i)=>{let p=t.offsetAt(n.start),m=t.offsetAt(n.end);(n.isEmpty||b[i]===-1)&&(b[i]=p);let f=o.filter(u=>u.open<=p&&u.close>=m).sort((u,d)=>u.close-u.open-(d.close-d.open));if(f.length===0){if(b[i]!==-1){let u=t.positionAt(b[i]);return b[i]=-1,new x.Selection(u,u)}return n}let a={start:p,end:m},r;for(let u=0;u<f.length;u++){let d=f[u];if(d.type==="attrValue"){if(a.start===d.open&&a.end===d.close){let h=f.find(v=>v.type==="attr"&&v.open<=d.open&&v.close>=d.close);h&&(r={start:h.open,end:h.close})}else r={start:d.open,end:d.close};break}else if(d.type==="attr"){if(a.start===d.open&&a.end===d.close){let h=f.find(v=>v.type==="openTag"&&v.open<=d.open&&v.close>=d.close);h&&(r={start:h.open,end:h.close})}else r={start:d.open,end:d.close};break}else if(d.type==="openTag"){let h=f.find(v=>!["attr","attrValue","openTag"].includes(v.type));h&&(r={start:h.open,end:h.close+1});break}else{let h=s.indexOf(">",d.open),v=s.lastIndexOf("<",d.close);if(h!==-1&&v!==-1&&h+1<=v){let P={start:h+1,end:v},C={start:d.open,end:d.close+1};if(a.start===P.start&&a.end===P.end)r=C;else if(a.start===C.start&&a.end===C.end){if(u+1<f.length){let A=f[u+1];r={start:A.open,end:A.close+1}}else if(b[i]!==-1){let A=t.positionAt(b[i]);return b[i]=-1,new x.Selection(A,A)}}else r=P;break}}}if(r)return new x.Selection(t.positionAt(r.start),t.positionAt(r.end));if(b[i]!==-1){let u=t.positionAt(b[i]);return b[i]=-1,new x.Selection(u,u)}return n});e.selections=l}var w=[];function X(){let e=x.window.activeTextEditor;if(!e)return;let t=e.document,s=t.getText(),c=e.selections,o=k(s);if(o.length===0)return;w.length<c.length?w=[...w,...Array(c.length-w.length).fill(-1)]:w.length>c.length&&(w=w.slice(0,c.length));let g=c.map((l,n)=>{let i=t.offsetAt(l.start),p=t.offsetAt(l.end);(l.isEmpty||w[n]===-1)&&(w[n]=i);let m=o.filter(r=>r.open<=i&&r.close>=p).sort((r,u)=>r.close-r.open-(u.close-u.open));if(m.length===0){if(w[n]!==-1){let r=t.positionAt(w[n]);return w[n]=-1,new x.Selection(r,r)}return l}let f={start:i,end:p},a;for(let r=0;r<m.length;r++){let u=m[r],d={start:u.open+1,end:u.close},h={start:u.open,end:u.close+1};if(f.start===d.start&&f.end===d.end){a=h;break}else if(f.start===h.start&&f.end===h.end){if(r+1<m.length){let v=m[r+1];a={start:v.open+1,end:v.close}}else if(w[n]!==-1){let v=t.positionAt(w[n]);return w[n]=-1,new x.Selection(v,v)}break}else{a=d;break}}if(a)return new x.Selection(t.positionAt(a.start),t.positionAt(a.end));if(w[n]!==-1){let r=t.positionAt(w[n]);return w[n]=-1,new x.Selection(r,r)}return l});e.selections=g}var y=T(require("vscode"));function B(){let e=y.window.activeTextEditor;if(!e)return;let t=e.document;y.window.showInputBox({prompt:"\u6587\u5B57\u5217\u3067\u56F2\u3080:"}).then(s=>{if(!s||s.length===0)return;let c={"(":")","{":"}","[":"]",'"':'"',"'":"'","`":"`","<":">"},o=s,g=c[o]??o,l=[];if(e.selections.forEach(n=>{let i,p;if(n.isEmpty){let m=t.getWordRangeAtPosition(n.active);if(!m)return;i=m.start,p=m.end}else i=n.start,p=n.end;l.push({start:i,end:p})}),l.length===0){y.window.showInformationMessage("\u56F2\u3080\u5BFE\u8C61\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093");return}e.edit(n=>{l.sort((i,p)=>t.offsetAt(p.start)-t.offsetAt(i.start)).forEach(i=>{n.insert(i.start,o),n.insert(i.end,g)})})})}var R=T(require("vscode"));function W(){let e=R.window.activeTextEditor;if(!e)return;let t=e.document,s=t.getText(),c=k(s);if(c.length===0){R.window.showInformationMessage("\u62EC\u5F27\u30FB\u30AF\u30A9\u30FC\u30C8\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093");return}R.window.showInputBox({prompt:"Replace bracket/quote:"}).then(o=>{if(o===void 0)return;let g={"(":")","{":"}","[":"]"},l=[];if(e.selections.forEach(n=>{let i=t.offsetAt(n.active),p=c.filter(u=>u.open<=i&&u.close>=i).sort((u,d)=>u.close-u.open-(d.close-d.open))[0];if(!p)return;let m=o,f=g[m]??o,a=t.positionAt(p.open),r=t.positionAt(p.close);l.push({range:new R.Range(a,a.translate(0,1)),text:m}),l.push({range:new R.Range(r,r.translate(0,1)),text:f})}),l.length===0){R.window.showInformationMessage("\u30AB\u30FC\u30BD\u30EB\u306E\u5916\u5074\u306B\u62EC\u5F27\u30FB\u30AF\u30A9\u30FC\u30C8\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093");return}e.edit(n=>{l.forEach(i=>n.replace(i.range,i.text))}).then(()=>{let n=e.selection;e.revealRange(new R.Range(n.active,n.active),R.TextEditorRevealType.InCenter)})})}function Y(e){let t=S.commands.registerCommand("bracketEx.changeSelection",M),s=S.commands.registerCommand("bracketEx.surroundWithInput",B),c=S.commands.registerCommand("bracketEx.replaceBracketsOrQuotes",W);e.subscriptions.push(t),e.subscriptions.push(s),e.subscriptions.push(c)}function _(){}0&&(module.exports={activate,deactivate});
